{"ast":null,"code":"'use strict';\n\nconst Model = require('./model.js');\nconst ItemArray = require('./item_array.js');\nconst ModelArray = require('./model_array.js');\nclass APIConstructor {\n  format(obj, arrInterface, useResource) {\n    if (obj instanceof Error) {\n      return this.error(obj.message, obj.details);\n    }\n    if (obj instanceof Model) {\n      let modelArray = new ModelArray(obj.constructor);\n      modelArray.setMeta({\n        total: 1,\n        offset: 0\n      });\n      modelArray.push(obj);\n      obj = modelArray;\n    }\n    if (!(obj instanceof ItemArray)) {\n      return this.spoof(obj);\n    }\n    return this.response(obj, arrInterface);\n  }\n  meta(total, count, offset, error, summary, resource) {\n    if (error) {\n      total = 0;\n      count = 0;\n      offset = 0;\n      resource = null;\n    }\n    let meta = {\n      total: total,\n      count: count,\n      offset: offset,\n      error: error\n    };\n    summary && (meta.summary = summary);\n    resource && (meta.resource = resource);\n    return meta;\n  }\n  error(message, details) {\n    return {\n      meta: this.meta(0, 0, 0, {\n        message: message,\n        details: details\n      }),\n      data: []\n    };\n  }\n  spoof(obj, useResource) {\n    if (!(obj instanceof Array)) {\n      obj = [obj];\n    }\n    return {\n      meta: this.meta(obj.length, obj.length, 0, null, null, useResource && this.resourceFromArray(obj)),\n      data: obj\n    };\n  }\n  response(itemArray, arrInterface, useResource) {\n    return {\n      meta: this.meta(itemArray._meta.total, itemArray.length, itemArray._meta.offset, null, null, useResource && this.resourceFromModelArray(itemArray, arrInterface)),\n      data: itemArray.toObject(arrInterface)\n    };\n  }\n  resourceFromArray(arr) {\n    function getType(v) {\n      v = v instanceof Array ? v[0] : v;\n      return {\n        'boolean': 'boolean',\n        'string': 'string',\n        'number': 'float'\n      }[typeof v] || (v instanceof Date ? 'datetime' : 'string');\n    }\n    ;\n    let fields = [];\n    if (arr.length && arr[0] && typeof arr[0] === 'object') {\n      let datum = arr[0];\n      fields = Object.keys(datum).map(function (v, i) {\n        return {\n          name: v,\n          type: getType(datum[v]),\n          array: v instanceof Array\n        };\n      });\n    }\n    return {\n      name: 'object',\n      fields: fields\n    };\n  }\n  resourceFromModelArray(modelArray, arrInterface) {\n    return modelArray._modelConstructor.toResource(arrInterface);\n  }\n}\nmodule.exports = new APIConstructor();","map":{"version":3,"names":["Model","require","ItemArray","ModelArray","APIConstructor","format","obj","arrInterface","useResource","Error","error","message","details","modelArray","constructor","setMeta","total","offset","push","spoof","response","meta","count","summary","resource","data","Array","length","resourceFromArray","itemArray","_meta","resourceFromModelArray","toObject","arr","getType","v","Date","fields","datum","Object","keys","map","i","name","type","array","_modelConstructor","toResource","module","exports"],"sources":["/Users/apps/node_modules/carthage/core/required/api.js"],"sourcesContent":["'use strict';\n\nconst Model = require('./model.js');\nconst ItemArray = require('./item_array.js');\nconst ModelArray = require('./model_array.js');\n\nclass APIConstructor {\n\n  format(obj, arrInterface, useResource) {\n\n    if (obj instanceof Error) {\n      return this.error(obj.message, obj.details);\n    }\n\n    if (obj instanceof Model) {\n      let modelArray = new ModelArray(obj.constructor);\n      modelArray.setMeta({total: 1, offset: 0});\n      modelArray.push(obj);\n      obj = modelArray;\n    }\n\n    if (!(obj instanceof ItemArray)) {\n      return this.spoof(obj);\n    }\n\n    return this.response(obj, arrInterface);\n\n  }\n\n  meta(total, count, offset, error, summary, resource) {\n\n    if (error) {\n      total = 0;\n      count = 0;\n      offset = 0;\n      resource = null;\n    }\n\n    let meta = {\n      total: total,\n      count: count,\n      offset: offset,\n      error: error\n    };\n\n    summary && (meta.summary = summary);\n    resource && (meta.resource = resource);\n\n    return meta;\n\n  }\n\n  error(message, details) {\n\n    return {\n      meta: this.meta(0, 0, 0, {message: message, details: details}),\n      data: []\n    };\n\n  }\n\n  spoof(obj, useResource) {\n\n    if (!(obj instanceof Array)) {\n      obj = [obj];\n    }\n\n    return {\n      meta: this.meta(\n        obj.length,\n        obj.length,\n        0,\n        null,\n        null,\n        useResource && this.resourceFromArray(obj)\n      ),\n      data: obj\n    }\n\n  }\n\n  response(itemArray, arrInterface, useResource) {\n\n    return {\n      meta: this.meta(\n        itemArray._meta.total,\n        itemArray.length,\n        itemArray._meta.offset,\n        null,\n        null,\n        useResource && this.resourceFromModelArray(itemArray, arrInterface)\n      ),\n      data: itemArray.toObject(arrInterface)\n    }\n\n  }\n\n  resourceFromArray(arr) {\n\n    function getType(v) {\n      v = (v instanceof Array) ? v[0] : v;\n      return {\n        'boolean': 'boolean',\n        'string': 'string',\n        'number': 'float'\n      }[(typeof v)] || ((v instanceof Date) ? 'datetime' : 'string');\n    };\n\n    let fields = [];\n\n    if (arr.length && arr[0] && typeof arr[0] === 'object') {\n      let datum = arr[0];\n      fields = Object.keys(datum).map(function(v, i) {\n\n        return {\n          name: v,\n          type: getType(datum[v]),\n          array: (v instanceof Array)\n        }\n\n      });\n    }\n\n    return {\n      name: 'object',\n      fields: fields\n    }\n\n  }\n\n  resourceFromModelArray(modelArray, arrInterface) {\n\n    return modelArray._modelConstructor.toResource(arrInterface);\n\n  }\n\n}\n\nmodule.exports = new APIConstructor();\n"],"mappings":"AAAA,YAAY;;AAEZ,MAAMA,KAAK,GAAGC,OAAO,CAAC,YAAY,CAAC;AACnC,MAAMC,SAAS,GAAGD,OAAO,CAAC,iBAAiB,CAAC;AAC5C,MAAME,UAAU,GAAGF,OAAO,CAAC,kBAAkB,CAAC;AAE9C,MAAMG,cAAc,CAAC;EAEnBC,MAAMA,CAACC,GAAG,EAAEC,YAAY,EAAEC,WAAW,EAAE;IAErC,IAAIF,GAAG,YAAYG,KAAK,EAAE;MACxB,OAAO,IAAI,CAACC,KAAK,CAACJ,GAAG,CAACK,OAAO,EAAEL,GAAG,CAACM,OAAO,CAAC;IAC7C;IAEA,IAAIN,GAAG,YAAYN,KAAK,EAAE;MACxB,IAAIa,UAAU,GAAG,IAAIV,UAAU,CAACG,GAAG,CAACQ,WAAW,CAAC;MAChDD,UAAU,CAACE,OAAO,CAAC;QAACC,KAAK,EAAE,CAAC;QAAEC,MAAM,EAAE;MAAC,CAAC,CAAC;MACzCJ,UAAU,CAACK,IAAI,CAACZ,GAAG,CAAC;MACpBA,GAAG,GAAGO,UAAU;IAClB;IAEA,IAAI,EAAEP,GAAG,YAAYJ,SAAS,CAAC,EAAE;MAC/B,OAAO,IAAI,CAACiB,KAAK,CAACb,GAAG,CAAC;IACxB;IAEA,OAAO,IAAI,CAACc,QAAQ,CAACd,GAAG,EAAEC,YAAY,CAAC;EAEzC;EAEAc,IAAIA,CAACL,KAAK,EAAEM,KAAK,EAAEL,MAAM,EAAEP,KAAK,EAAEa,OAAO,EAAEC,QAAQ,EAAE;IAEnD,IAAId,KAAK,EAAE;MACTM,KAAK,GAAG,CAAC;MACTM,KAAK,GAAG,CAAC;MACTL,MAAM,GAAG,CAAC;MACVO,QAAQ,GAAG,IAAI;IACjB;IAEA,IAAIH,IAAI,GAAG;MACTL,KAAK,EAAEA,KAAK;MACZM,KAAK,EAAEA,KAAK;MACZL,MAAM,EAAEA,MAAM;MACdP,KAAK,EAAEA;IACT,CAAC;IAEDa,OAAO,KAAKF,IAAI,CAACE,OAAO,GAAGA,OAAO,CAAC;IACnCC,QAAQ,KAAKH,IAAI,CAACG,QAAQ,GAAGA,QAAQ,CAAC;IAEtC,OAAOH,IAAI;EAEb;EAEAX,KAAKA,CAACC,OAAO,EAAEC,OAAO,EAAE;IAEtB,OAAO;MACLS,IAAI,EAAE,IAAI,CAACA,IAAI,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE;QAACV,OAAO,EAAEA,OAAO;QAAEC,OAAO,EAAEA;MAAO,CAAC,CAAC;MAC9Da,IAAI,EAAE;IACR,CAAC;EAEH;EAEAN,KAAKA,CAACb,GAAG,EAAEE,WAAW,EAAE;IAEtB,IAAI,EAAEF,GAAG,YAAYoB,KAAK,CAAC,EAAE;MAC3BpB,GAAG,GAAG,CAACA,GAAG,CAAC;IACb;IAEA,OAAO;MACLe,IAAI,EAAE,IAAI,CAACA,IAAI,CACbf,GAAG,CAACqB,MAAM,EACVrB,GAAG,CAACqB,MAAM,EACV,CAAC,EACD,IAAI,EACJ,IAAI,EACJnB,WAAW,IAAI,IAAI,CAACoB,iBAAiB,CAACtB,GAAG,CAC3C,CAAC;MACDmB,IAAI,EAAEnB;IACR,CAAC;EAEH;EAEAc,QAAQA,CAACS,SAAS,EAAEtB,YAAY,EAAEC,WAAW,EAAE;IAE7C,OAAO;MACLa,IAAI,EAAE,IAAI,CAACA,IAAI,CACbQ,SAAS,CAACC,KAAK,CAACd,KAAK,EACrBa,SAAS,CAACF,MAAM,EAChBE,SAAS,CAACC,KAAK,CAACb,MAAM,EACtB,IAAI,EACJ,IAAI,EACJT,WAAW,IAAI,IAAI,CAACuB,sBAAsB,CAACF,SAAS,EAAEtB,YAAY,CACpE,CAAC;MACDkB,IAAI,EAAEI,SAAS,CAACG,QAAQ,CAACzB,YAAY;IACvC,CAAC;EAEH;EAEAqB,iBAAiBA,CAACK,GAAG,EAAE;IAErB,SAASC,OAAOA,CAACC,CAAC,EAAE;MAClBA,CAAC,GAAIA,CAAC,YAAYT,KAAK,GAAIS,CAAC,CAAC,CAAC,CAAC,GAAGA,CAAC;MACnC,OAAO;QACL,SAAS,EAAE,SAAS;QACpB,QAAQ,EAAE,QAAQ;QAClB,QAAQ,EAAE;MACZ,CAAC,CAAE,OAAOA,CAAC,CAAE,KAAMA,CAAC,YAAYC,IAAI,GAAI,UAAU,GAAG,QAAQ,CAAC;IAChE;IAAC;IAED,IAAIC,MAAM,GAAG,EAAE;IAEf,IAAIJ,GAAG,CAACN,MAAM,IAAIM,GAAG,CAAC,CAAC,CAAC,IAAI,OAAOA,GAAG,CAAC,CAAC,CAAC,KAAK,QAAQ,EAAE;MACtD,IAAIK,KAAK,GAAGL,GAAG,CAAC,CAAC,CAAC;MAClBI,MAAM,GAAGE,MAAM,CAACC,IAAI,CAACF,KAAK,CAAC,CAACG,GAAG,CAAC,UAASN,CAAC,EAAEO,CAAC,EAAE;QAE7C,OAAO;UACLC,IAAI,EAAER,CAAC;UACPS,IAAI,EAAEV,OAAO,CAACI,KAAK,CAACH,CAAC,CAAC,CAAC;UACvBU,KAAK,EAAGV,CAAC,YAAYT;QACvB,CAAC;MAEH,CAAC,CAAC;IACJ;IAEA,OAAO;MACLiB,IAAI,EAAE,QAAQ;MACdN,MAAM,EAAEA;IACV,CAAC;EAEH;EAEAN,sBAAsBA,CAAClB,UAAU,EAAEN,YAAY,EAAE;IAE/C,OAAOM,UAAU,CAACiC,iBAAiB,CAACC,UAAU,CAACxC,YAAY,CAAC;EAE9D;AAEF;AAEAyC,MAAM,CAACC,OAAO,GAAG,IAAI7C,cAAc,CAAC,CAAC"},"metadata":{},"sourceType":"script","externalDependencies":[]}